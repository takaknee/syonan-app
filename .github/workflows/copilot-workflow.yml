name: Copilot-Assisted Development Workflow

on:
  pull_request:
    types: [opened, synchronize, reopened]
  issue_comment:
    types: [created]

jobs:
  code-quality-check:
    name: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: Flutterç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.x'
        cache: true
        
    - name: ä¾å­˜é–¢ä¿‚ã®å–å¾—
      run: |
        if [ -f pubspec.yaml ]; then
          flutter pub get
        else
          echo "pubspec.yaml ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã¾ã åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚"
        fi
        
    - name: Dartè§£æ
      run: |
        if [ -f pubspec.yaml ]; then
          flutter analyze
        else
          echo "Dartè§£æã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
        fi
        
    - name: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
      run: |
        if [ -f pubspec.yaml ]; then
          dart format --set-exit-if-changed .
        else
          echo "ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
        fi

  copilot-suggestions:
    name: Copiloté–‹ç™ºææ¡ˆ
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—
      id: changed-files
      uses: tj-actions/changed-files@v40
      with:
        files: |
          **/*.dart
          **/*.yaml
          **/*.md
          
    - name: Copiloté–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®ç¢ºèª
      run: |
        echo "å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.changed-files.outputs.all_changed_files }}"
        echo ""
        echo "ğŸ¤– GitHub Copiloté–‹ç™ºææ¡ˆ:"
        echo ""
        echo "1. .github/instructions/copilot-guidelines.md ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        echo "2. .github/prompts/ ã®åŠ¹æœçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„"
        echo "3. å­ä¾›å‘ã‘ã‚¢ãƒ—ãƒªã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        echo "4. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¦ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„"
        echo "5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„"
        echo ""
        echo "ğŸ“ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:"
        echo "- GitHub Copilot Chatã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¾é ¼"
        echo "- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ç¢ºèª"
        echo "- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š"
        echo "- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°"

  auto-documentation:
    name: è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
      run: |
        echo "ğŸ“š è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ"
        echo ""
        echo "ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæœ€æ–°ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„:"
        echo ""
        echo "- README.md: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã¨é–‹å§‹æ–¹æ³•"
        echo "- .github/copilot-context.md: Copilotã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±"
        echo "- .github/instructions/: é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³"
        echo "- .github/prompts/: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
        echo ""
        echo "ğŸ”§ GitHub Copilotã‚’ä½¿ç”¨ã—ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°:"
        echo "1. '@github generate documentation for this PR'"
        echo "2. '@github explain the changes in this PR'"
        echo "3. '@github suggest improvements for code quality'"

  issue-automation:
    name: ã‚¤ã‚·ãƒ¥ãƒ¼è‡ªå‹•åŒ–
    runs-on: ubuntu-latest
    if: github.event_name == 'issue_comment' && contains(github.event.comment.body, '@copilot-helper')
    
    steps:
    - name: Copilotãƒ˜ãƒ«ãƒ‘ãƒ¼å¿œç­”
      run: |
        echo "ğŸ¤– Copilotãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒèµ·å‹•ã•ã‚Œã¾ã—ãŸ"
        echo ""
        echo "åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
        echo "- @copilot-helper analyze: ã‚³ãƒ¼ãƒ‰è§£æã®å®Ÿè¡Œ"
        echo "- @copilot-helper test: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ææ¡ˆ"
        echo "- @copilot-helper security: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ"
        echo "- @copilot-helper docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã®ææ¡ˆ"
        echo ""
        echo "è©³ç´°ãªãƒ˜ãƒ«ãƒ—ã«ã¤ã„ã¦ã¯ .github/instructions/ ã‚’å‚ç…§ã—ã¦ãã ã•ã„"